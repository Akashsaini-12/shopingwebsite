import{d as e,q as o,aB as t,ax as n,t as r,T as l,aD as i,i as s,B as a,o as c,y as d,s as u,g as p,a1 as f,u as h,x as m,I as v,_ as g,R as w,p as N,A as b,n as _,U as O,l as x,aE as y}from"./chunk.common_CnfwdMT9.esm.js";import{M as I,A as k}from"./chunk.modal_B6Z16tND.esm.js";function F(e,o){return a(this,void 0,void 0,(function*(){try{const t=yield fetch(e,o);return"ok"in t&&!t.ok?null:function(e){return a(this,void 0,void 0,(function*(){try{return e&&"function"==typeof e.json?yield e.json():null}catch(e){return null}}))}(t)}catch(e){return null}}))}function L(o){var t;const{notify:n}=c(),[r,l]=e(null),[i,s]=e(!1);d((()=>{(()=>{a(this,void 0,void 0,(function*(){const e=yield function(){return a(this,arguments,void 0,(function*(e=location.origin){return F(`${e}/meta.json`)}))}(o);e?l(e):n(new Error("Failed to fetch store metadata")),s(!0)}))})()}),[n,o]);const u=null!==(t=null==r?void 0:r.name)&&void 0!==t?t:"the store";return{loaded:i,storeId:null==r?void 0:r.id,storeMetadata:r,storeName:u}}function C({anchorElement:e,devMode:o,onClose:t,storefrontOrigin:n}){var r;const{trackUserAction:l}=u(),{translate:i}=p(),{loaded:a,storeId:c,storeName:d}=L(n),v=c?`https://shop.app/sid/${c}`:"#";if(f()){const e=i("shopFollowButton.followingModal.title",{store:d}),o=i("shopFollowButton.followingModal.subtitle"),n=i("shopFollowButton.continueGeneric");return h(I,{headerLogo:h(m,{className:"h-4-5 text-purple-primary"}),onDismiss:t,popupDisabled:!0,variant:"follow",visible:a,children:h("div",{className:"m-auto p-6 font-sans",children:[h("div",{className:"relative m-auto pb-4 text-center",children:[h("h2",{className:"mb-2 px-6 text-subtitle text-black",children:e}),h("p",{className:"overflow-hidden text-ellipsis whitespace-pre-line text-body-small text-grayscale-d1",children:o})]}),h("div",{className:"flex justify-center",children:h("button",{className:"w-full rounded-md bg-purple-primary p-3 leading-6 text-white no-underline",onClick:function(){l({userAction:"FOLLOWING_GET_SHOP_APP_CLICK"}),s.open(v,"_self"),t()},type:"button",children:n})})]})})}const g=null!==(r=i("shopFollowButton.followingModal.qrAltText"))&&void 0!==r?r:"";let w=c?`https://shop.app/qr/sid/${c}`:"#";return o&&(w="https://shop.app/qr/sid/59659354134"),h(I,{anchorTo:e,disableMinWidth:!0,hideHeader:!0,onDismiss:t,popupDisabled:!0,variant:"follow",visible:a,children:h("div",{className:"m-auto w-55 p-6 font-sans",children:[h("div",{className:"relative m-auto pb-4 text-center",children:h("p",{className:"overflow-hidden text-ellipsis whitespace-pre-line text-grayscale-d1",children:i("shopFollowButton.followingModal.qrHeader",{store:d})})}),h("div",{className:"m-auto w-37 bg-white forced-color-adjust-none",children:h("img",{src:w,alt:g})}),h("div",{className:"flex justify-center px-0 pb-0 pt-4 text-purple-primary",children:h(m,{className:"h-5"})})]})})}function M({className:e,filled:o}){return h("svg",{className:e,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20",children:h("path",{fill:o?"currentColor":"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"1.667",d:"m9.14 4.502.86.881.86-.881a3.82 3.82 0 0 1 5.437-.064l.064.064c1.498 1.536 1.518 4.014.062 5.576l-.062.066L10 16.666l-6.36-6.524c-1.52-1.557-1.52-4.083 0-5.641a3.822 3.822 0 0 1 5.5 0Z"})})}const E=({clientId:f,devMode:v=!1,storefrontOrigin:g})=>{const{trackPageImpression:w,trackUserAction:I}=u(),{translate:F}=p(),L=N(),{notify:E}=c(),S=b(null),A=b(null),[B,T]=function({key:r,type:l="localStorage",defaultValue:i}){const s=`signInWithShop:${r}`,[a,c]=e((()=>{const e=n(s,{session:"sessionStorage"===l});if(!e)return i;try{return JSON.parse(e)}catch(e){return i}}));return[a,o((e=>{c(e),t(s,JSON.stringify(e),{session:"sessionStorage"===l})}),[s,l])]}({key:"following",defaultValue:!1}),[P,j]=e(!1),[D,W]=e(!1),z=function(e){const{recordCounter:o}=r();return l((()=>{try{if(e&&i(e))return e}catch(e){e instanceof Error&&o("shop_js_invalid_storefront_origin",{attributes:{error:e}})}return s.location.origin}),[e,o])}(g),[G,H]=e();d((()=>{w({page:B?"COMPONENT_LOADED_FOLLOWING":"COMPONENT_LOADED_NOT_FOLLOWING"})}),[B,w]),d((()=>{if(!S.current||void 0===w||!x())return;const e=new IntersectionObserver((o=>{for(const{isIntersecting:t}of o)t&&(null==e||e.disconnect(),w({page:"FOLLOW_BUTTON_SHOWN_IN_VIEWPORT"}))}));return e.observe(S.current),()=>{e.disconnect()}}),[w]);const q=o((()=>{var e;return B?(w({page:"FOLLOWING_GET_SHOP_APP_CTA"}),j(!0)):(I({userAction:"FOLLOW_ON_SHOP_CLICKED"}),v?T(!0):(W(!0),void(null===(e=A.current)||void 0===e||e.open("user_button_clicked"))))}),[v,B,T,w,I]);const U=_("absolute inset-y-0 -z-10 rounded-max bg-purple-primary",B?"w-9 animate-follow":"w-full group-hover_bg-purple-d0"),V=_("group relative inline-flex h-9 items-center rounded-max bg-transparent",B&&"gap-x-1-5"),$=_("cursor-pointer whitespace-nowrap pr-3 font-sans text-button-large transition-colors",B?"text-black":"text-white"),R=B?"shopFollowButton.following":"shopFollowButton.follow",{authorizeUrl:J}=O({clientId:f,error:G,flow:"follow",proxy:!0,redirectType:"iframe",responseType:"code"}),K=D?h(k,{onClose:()=>j(!1),onComplete:function(e){return a(this,arguments,void 0,(function*({loggedIn:e,shouldFinalizeLogin:o,email:t}){e&&o&&(yield y(z,(e=>{E(new Error(e))}))),L("completed",{loggedIn:e,email:t}),T(!0),W(!1),j(!1)}))},onError:function({code:e,email:o,message:t}){var n;L("error",{code:e,email:o,message:t}),"retriable_server_error"===e&&(G===e&&(null===(n=A.current)||void 0===n||n.reload()),H("retriable_server_error"))},onLoaded:function(){var e;!B&&D&&(null===(e=A.current)||void 0===e||e.open("user_button_clicked"))},proxy:!0,ref:A,src:J,storefrontOrigin:z,variant:"follow"}):null,Q=B&&P&&z?h(C,{anchorElement:S,devMode:v,onClose:()=>j(!1),storefrontOrigin:z}):null;return h("div",{className:"relative z-0",children:[h("button",{className:V,onClick:q,type:"button",ref:S,children:[h("div",{className:U}),h("div",{className:"px-2 text-white",children:h(M,{className:"size-5",filled:B})}),h("span",{className:$,children:F(R,{shop:h(m,{className:"relative inline-block h-4 w-auto"})})})]}),K,Q]})},S=e=>a(void 0,void 0,void 0,(function*(){return{shopFollowButton:{follow:"In {shop} folgen",following:"In {shop} gefolgt",continueGeneric:"Fortfahren",followingModal:{title:"{store} in Shop besuchen",subtitle:"Alles, was du zum Einkaufen, Verfolgen und Bezahlen brauchst – an einem zentralen Ort.",qrHeader:"Scannen, um {store} in der Shop-App aufzurufen",qrAltText:"QR-Code für Shop-App"}}}}));v((e=>{var{devMode:o,element:t}=e,n=g(e,["devMode","element"]);return h(w,{devMode:o,element:t,monorailProps:{analyticsContext:"loginWithShopFollow",flow:"follow"},featureName:"ShopFollowButton",getFeatureDictionary:S,children:h(E,Object.assign({},n,{devMode:o}))})}),{name:"shop-follow-button",props:{clientId:"string",devMode:"boolean",storefrontOrigin:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-follow-button_CAxR2HUu.de.esm.js.map
