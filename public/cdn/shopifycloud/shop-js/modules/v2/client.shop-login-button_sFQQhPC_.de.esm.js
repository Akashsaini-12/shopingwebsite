import{i as e,I as o,_ as t,u as n,R as i,e as r,o as s,s as a,g as l,d as c,h as d,A as u,j as p,J as h,K as g,y as m,T as f,L as S,M as v,q as _,B as y,N as b,O as w,Q as I,U as C,V as x,W,X as T,Y as O,Z as k,a0 as M,a1 as A,k as U}from"./chunk.common_CnfwdMT9.esm.js";import{A as B}from"./chunk.modal_B6Z16tND.esm.js";const N={loginWithShop:"default",loginWithShopEmbed:"embed",loginWithShopSelfServe:"self_serve_customer_accounts",loginWithShopClassicCustomerAccounts:"classic_customer_accounts",loginWithShopPrequal:"shop_pay_installments_prequal",loginWithShopPaymentRequest:"payment_request",loginWithShopCheckoutExtension:"default",loginWithShopCheckoutModal:"checkout_modal",loginWithShopShopWeb:"",shopCashOffers:"shop_cash_offers"};function P({analyticsContext:e="loginWithShop",checkoutToken:o,checkoutVersion:t,flowVersion:n,shopId:i,source:r,uxMode:s}){return{analyticsContext:e,checkoutVersion:t,checkoutToken:o,flow:N[e],flowVersion:n,shopId:i,source:r,uxMode:s}}const L=["loginWithShop"],E=o=>{var{action:i,activatorId:N,analyticsContext:P="loginWithShop",anchorTo:E,autoOpen:j,bordered:q,email:R,emailInputSelector:V,experiments:H,firstname:z,fullWidth:G,hideButton:K,lastname:D,persistAfterSignIn:F=!0,proxy:$=!1,uxMode:J="iframe",version:Q}=o,X=t(o,["action","activatorId","analyticsContext","anchorTo","autoOpen","bordered","email","emailInputSelector","experiments","firstname","fullWidth","hideButton","lastname","persistAfterSignIn","proxy","uxMode","version"]);const{dispatch:Y}=r(),{notify:Z}=s(),{trackPageImpression:ee,trackUserAction:oe}=a(),{translate:te}=l(),[ne,ie]=c(!0),{instanceId:re}=d(),se=u(N?p.getElementById(N):null),ae=u(null),le=u(null),ce=u(null),[de,ue]=c(),pe=h({defaultUxMode:"redirect",uxMode:J}),{getSubmittedEmail:he,updateEmailToPost:ge,updateNamesToPost:me}=g({email:R,emailInputSelector:V,iframeRef:le});m((()=>{me(z,D)}),[z,D,me]);const fe=f((()=>{const e=e=>y(void 0,[e],void 0,(function*({detail:e}){ue(void 0);const o=e.email;yield ge(o)}));return{requestShow:e,start:e}}),[ge]);S(fe),m((()=>{var e,o;i&&("follow"===i?null===(e=console.warn)||void 0===e||e.call(console,"[Sign in with Shop] The action prop is deprecated, please use <shop-follow-button> instead."):null===(o=console.warn)||void 0===o||o.call(console,`[Sign in with Shop] Received deprecated attribute: action, "${i}"`))}),[i,Z]),m((()=>{K||ee({page:"SIGN_IN_WITH_SHOP_BUTTON"})}),[K,ee]);const Se=v({storefrontOrigin:X.storefrontOrigin}),ve=_((e=>y(void 0,void 0,void 0,(function*(){const{email:o,givenName:t,userInteracted:n}=e;let i;F||ie(!1),n||(i=te("shopLoginButton.toast.action"));let r=te("shopLoginButton.toast.default");t&&(r=te("shopLoginButton.toast.user",{user:t}));const s={actionText:i,analyticsTraceId:re,flow:X.flow,subText:o,text:r};L.includes(P)?b(s):"windoid"===pe&&w(I,s),yield Se(e)}))),[pe,P,re,F,X.flow,te,Se]),_e="loginWithShopPrequal"===P?{disableSignUp:!1,flow:"prequal",flowVersion:"unspecified",hideCopy:!1,isCompactLayout:!1,proxy:!0}:{},ye=f((()=>{var e;return void 0!==Q&&(null===(e=console.warn)||void 0===e||e.call(console,`[Sign in with Shop] Received deprecated attribute: version, "${Q}"`)),$||"2"===Q}),[$,Q]),{authorizeUrl:be,getAuthorizeUrl:we}=C(Object.assign(Object.assign(Object.assign({analyticsContext:P,error:de,experiments:H},X),{proxy:ye,uxMode:pe}),_e)),Ie=_((({code:e})=>{var o;switch(e){case"server_error":b({analyticsTraceId:re,flow:X.flow,text:te("shopLoginButton.subject_mapping_error"),variant:"error"});break;case"retriable_server_error":de===e&&(null===(o=le.current)||void 0===o||o.reload()),ue(e)}}),[de,re,X.flow,te]),Ce=x({handleClose:()=>{Y({type:"windoidClosed"})},handleComplete:ve,handleError:Ie,handleOpen:()=>{Y({type:"windoidOpened"})},windoidRef:ce}),xe=_((o=>{switch(pe){case"windoid":ce.current=W(o,Ce);break;case"redirect":e.location.href=o}}),[pe,Ce]),We=_((()=>{oe({userAction:"SIGN_IN_WITH_SHOP_BUTTON_CLICK"}),xe(be)}),[be,xe,oe]),Te=T(We,150,!0),Oe=_((()=>{var e;oe({userAction:"SIGN_IN_WITH_SHOP_PROMPT_CHANGE_CLICK"}),null===(e=null==le?void 0:le.current)||void 0===e||e.close({dismissMethod:"prompt_change",reason:"user_prompt_change_clicked"})}),[oe]),ke=O({getAuthorizeUrl:we,getEmail:he,iframeRef:le,openWindoid:xe}),Me=K||se.current||!ne?null:n(M,{bordered:q,fullWidth:G,onClick:Te,ref:ae,children:te("shopLoginButton.continue",{shop:n(k,{})})}),Ae="iframe"===pe,Ue=se.current?se:ae,Be=Ae?Ue:void 0,Ne=f((()=>Ae?be:we({uxRole:"prompt"})),[be,we,Ae]),Pe=Ae||A()?"default":"wide",Le=f((()=>{const o=!(void 0===e||!e.Shopify||!e.Shopify.SignInWithShop)&&["initCustomerAccounts","initCustomerAccountsSignUp","initShopForNewCustomerAccounts"].some((o=>"function"==typeof e.Shopify.SignInWithShop[o]));return"windoid"!==pe&&"redirect"!==pe||o}),[pe]);return n(U,{children:[Me,Le&&n(B,{activator:Be,anchorTo:E,autoOpen:j&&!ce.current,onComplete:ve,onError:Ie,onPromptChange:Oe,onPromptContinue:ke,proxy:ye,ref:le,src:Ne,modalType:Pe,variant:"default"})]})},j=e=>y(void 0,void 0,void 0,(function*(){return{shopLoginButton:{continue:"Bei {shop} anmelden",toast:{default:"Mit Shop angemeldet",user:"Als {user} angemeldet",action:"Wechseln"},title:"Mit Shop anmelden",subject_mapping_error:"Um dich mit dieser E-Mail-Adresse anzumelden, fahre ohne Shop fort."}}}));o((e=>{var{element:o}=e,r=t(e,["element"]);return n(i,{element:o,featureName:"ShopLoginButton",getFeatureDictionary:j,monorailProps:P(r),children:n(E,Object.assign({},r))})}),{methods:["requestShow","start","showToast"],name:"shop-login-button",props:{action:"string",activatorId:"string",analyticsContext:"string",anchorTo:"string",apiKey:"string",autoOpen:"boolean",avoidPayAltDomain:"boolean",bordered:"boolean",checkoutVersion:"string",clientId:"string",codeChallenge:"string",codeChallengeMethod:"string",consentChallenge:"string",disableSignUp:"boolean",email:"string",emailInputSelector:"string",experiments:"string",firstname:"string",flow:"string",flowVersion:"string",fullWidth:"boolean",hideButton:"boolean",keepModalOpen:"boolean",lastname:"string",persistAfterSignIn:"boolean",popUpFeatures:"string",popUpName:"string",proxy:"boolean",proxyCoreIdp:"boolean",redirectType:"string",redirectUri:"string",requireVerification:"boolean",responseMode:"string",responseType:"string",returnUri:"string",scope:"string",source:"string",state:"string",storefrontDomain:"string",uxMode:"string",version:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-login-button_sFQQhPC_.de.esm.js.map
